-- ==================================== TABLES ====================================
CREATE TABLE ROL (
    ID_ROL NUMBER(15) NOT NULL,
    NOMBRE VARCHAR2(50) NOT NULL,
    DESCRIPCION VARCHAR2(70) NOT NULL,
    CONSTRAINT PK_ROL PRIMARY KEY (ID_ROL)
);

CREATE TABLE USUARIO (
    ID_USUARIO NUMBER(15) NOT NULL,
    CLAVE  VARCHAR2(50),
    CORREO VARCHAR2(50) ,
    NOMBRE VARCHAR2(50) NOT NULL,
    AP_PATERNO VARCHAR2(50) NOT NULL,
    AP_MATERNO VARCHAR2(50),
    NOMBRE_COMPLETO VARCHAR2(150) NOT NULL,
    TELEFONO VARCHAR2(10) ,
    -- ACTIVO, ELIMINADO, BLOQUEADO
    ESTATUS VARCHAR2(30) NOT NULL,
    FALLOS NUMBER(1) NOT NULL,
    CONSTRAINT PK_USUARIO PRIMARY KEY (ID_USUARIO),
    CONSTRAINT UC_USUARIO UNIQUE (CORREO)
);

CREATE TABLE ALUMNO (
    ID_ALUMNO NUMBER(15) NOT NULL,
    CLAVE  VARCHAR2(50),
    CORREO VARCHAR2(50) ,
    NOMBRE VARCHAR2(50) NOT NULL,
    AP_PATERNO VARCHAR2(50) NOT NULL,
    AP_MATERNO VARCHAR2(50),
    NOMBRE_COMPLETO VARCHAR2(150) NOT NULL,
    -- ACTIVO, ELIMINADO, BLOQUEADO
    ESTATUS VARCHAR2(30) NOT NULL,
    FALLOS NUMBER(1) NOT NULL,
    CONSTRAINT PK_ALUMNO PRIMARY KEY (ID_ALUMNO),
    CONSTRAINT UC_ALUMNO UNIQUE (CORREO)
);

CREATE TABLE ROL_USUARIO (
    ID_ROL NUMBER(15) NOT NULL,
    ID_USUARIO NUMBER(15) NOT NULL,
    CONSTRAINT PK_ROL_USUARIO PRIMARY KEY (ID_ROL, ID_USUARIO),
    CONSTRAINT FK_RU_ROL FOREIGN KEY (ID_ROL) REFERENCES ROL(ID_ROL),
    CONSTRAINT FK_RU_USUARIO FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE ROL_ALUMNO (
    ID_ROL NUMBER(15) NOT NULL,
    ID_ALUMNO NUMBER(15) NOT NULL,
    CONSTRAINT PK_ROL_ALUMNO PRIMARY KEY (ID_ROL, ID_ALUMNO),
    CONSTRAINT FK_RA_ROL FOREIGN KEY (ID_ROL) REFERENCES ROL(ID_ROL),
    CONSTRAINT FK_RA_ALUMNO FOREIGN KEY (ID_ALUMNO) REFERENCES ALUMNO(ID_ALUMNO)
);

 CREATE TABLE CARRERA(
	ID_CARRERA NUMBER(15) NOT NULL, 
	DESCRIPCION VARCHAR(50) NOT NULL,
	CONSTRAINT PK_CARRERA PRIMARY KEY (ID_CARRERA)
);

CREATE TABLE GRUPO(
	ID_GRUPO NUMBER(15) NOT NULL,
	GRUPO VARCHAR(10) NOT NULL,
	ID_CARRERA NUMBER(15) NOT NULL,
	CUATRIMESTRE VARCHAR(50) NOT NULL,
	ID_USUARIO NUMBER(15) NOT NULL,
	CONSTRAINT PK_GRUPO PRIMARY KEY(ID_GRUPO),
	CONSTRAINT FK_CARRERA FOREIGN KEY(ID_CARRERA) REFERENCES CARRERA(ID_CARRERA),
	CONSTRAINT FK_G_USUARIO FOREIGN KEY(ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE GRUPO_ALUMNO(
	ID_ALUMNO NUMBER(15) NOT NULL,
	ID_GRUPO NUMBER(15) NOT NULL,
	CONSTRAINT FK_GU_ALUMNO FOREIGN KEY(ID_ALUMNO) REFERENCES ALUMNO(ID_ALUMNO),
	CONSTRAINT FK_GU_GRUPO FOREIGN KEY(ID_GRUPO) REFERENCES GRUPO(ID_GRUPO)	
);

CREATE TABLE MATERIA(
	ID_MATERIA NUMBER(15) NOT NULL,
	DESCRIPCION VARCHAR(50) NOT NULL,
	CONSTRAINT PK_MATERIA PRIMARY KEY(ID_MATERIA)
);

CREATE TABLE CURSO( 
	ID_CURSO NUMBER(15) NOT NULL,
	ID_MATERIA NUMBER(15) NOT NULL,
	ID_GRUPO NUMBER(15) NOT NULL,
	PARCIAL NUMBER(2) NOT NULL,
	CONSTRAINT PK_CURSO PRIMARY KEY(ID_CURSO),
	CONSTRAINT FK_C_MATERIA FOREIGN KEY (ID_MATERIA) REFERENCES MATERIA(ID_MATERIA),
	CONSTRAINT FK_C_GRUPO FOREIGN KEY (ID_GRUPO) REFERENCES GRUPO(ID_GRUPO)
	
);

CREATE TABLE ASISTENCIA(
	ID_ASISTENCIA NUMBER(15) NOT NULL,
	FECHA DATE NOT NULL,
	ID_CURSO NUMBER(15) NOT NULL,
	CONSTRAINT PK_ASISTENCIA PRIMARY KEY(ID_ASISTENCIA),
	CONSTRAINT FK_AS_CURSO FOREIGN KEY(ID_CURSO) REFERENCES CURSO(ID_CURSO)
);

CREATE TABLE ASISTENCIA_ALUMNO(
	ID_ASISTENCIA NUMBER(15) NOT NULL,
	ID_ALUMNO NUMBER(15) NOT NULL,
	ASISTIO NUMBER(2) NOT NULL,
	CONSTRAINT FK_AA_ALUMNO FOREIGN KEY(ID_ALUMNO) REFERENCES ALUMNO(ID_ALUMNO),
	CONSTRAINT FK_AA_ASISTENCIA FOREIGN KEY(ID_ASISTENCIA) REFERENCES ASISTENCIA(ID_ASISTENCIA)
	);

CREATE TABLE CALIFICACION( 
	ID_CALIFICACION NUMBER(15) NOT NULL,
	ID_CURSO NUMBER(15) NOT NULL,
	CONSTRAINT PK_CALIFICACION PRIMARY KEY(ID_CALIFICACION),
	CONSTRAINT FK_CA_CURSO FOREIGN KEY (ID_CURSO) REFERENCES CURSO(ID_CURSO),
);

CREATE TABLE CALIFICACION_ALUMNO(
	ID_CALIFICACION NUMBER(15) NOT NULL,
	ID_ALUMNO NUMBER(15) NOT NULL,
	NOTA VARCHAR(5),
	DESCRIPCION VARCHAR(50),
	OBSERVACIONES VARCHAR(100),
	CONSTRAINT FK_CALAL_CALI FOREIGN KEY(ID_CALIFICACION) REFERENCES CALIFICACION(ID_CALIFICACION),
	CONSTRAINT FK_CALAL_ALU FOREIGN KEY(ID_ALUMNO) REFERENCES ALUMNO(ID_ALUMNO)	
);

-- ====================================== SEQUENCES ======================================
CREATE SEQUENCE SEQ_ROL
START WITH 1
INCREMENT BY 1 NOCACHE NOCYCLE;


CREATE SEQUENCE SEQ_USUARIO
START WITH 1
INCREMENT BY 1 NOCACHE NOCYCLE;

CREATE SEQUENCE SEQ_ALUMNO
START WITH 1
INCREMENT BY 1 NOCACHE NOCYCLE;

--CREATE SEQUENCE SEQ_CARRERA
--START WITH 1
--INCREMENT BY 1 NOCACHE NOCYCLE;

--CREATE SEQUENCE SEQ_GRUPO
--START WITH 1
--INCREMENT BY 1 NOCACHE NOCYCLE;

--CREATE SEQUENCE SEQ_ASISTENCIA
--START WITH 1
--INCREMENT BY 1 NOCACHE NOCYCLE;

